jQuery(function ($) {
    $('body').append("<html lang='en'><head> <link rel='stylesheet' href='//dcapi.direct-credit.ru/style.css' type='text/css' /> <script src='//dcapi.direct-credit.ru/JsHttpRequest.js' type='text/javascript' ></script> <script src='//dcapi.direct-credit.ru/dc.js' charset='utf-8' type='text/javascript' ></script> <script type='text/javascript'> const partnerID = '495817767'; const codeTT = '501872799' const debug = true; </script> </head> <body></body> <script> /** ID кнопки, запускающей модальное окно первого шага кредита (наше окно) */ var click_on_credit_id = '#click_on_credit' /** ID формы перового шага кредита */ var credit_form_id = '#credit_form' /** ID карточки товара */ var card_product = '#card_product' /** Объект формы */ var formProps /** Рандомная строка номера заказа */ var id var phone_raw = null /** Телефон из формы */ var phone /** Цена товара */ var price = null /** Название товара */ var name_product = null jQuery(function ($) { $(function () { $(document).on('mouseup touchend', click_on_credit_id, function (e) { price = $(this).closest(card_product).find('.sale-price .woocommerce-Price-amount')[0].innerText.replace(/D/g, '') name_product = $(this).closest(card_product).find('.elementor-heading-title')[0].innerText }); }); /** После в */ jQuery(document).on('submit_success', credit_form_id, (e) => { let formData = new FormData(e.target) formProps = Object.fromEntries(formData); console.log(formProps, name_product) phone_raw = formProps['form_fields[Tel]'] id = Math.random().toString(36).slice(2, 15); price = price ?? $('#price')[0].innerText.replace(/D/g, '') phone = formProps['form_fields[Tel]'].replace(/[^d.]/g, '').replace(/^7|8/, ''); name_product = name_product ?? formProps['form_fields[post_title_my]'] let regex = /^9[0-9]{9}$/; if (!regex.test(phone)) { alert('Введите корректный номер телефона и повторите попытку') return false } let arr = [{ id: id, price: price, count: '1', type: 'Мототехника', name: name_product }]; console.log(arr) DCLoans(partnerID, 'delProduct', false, (result) => { if (result.status) { DCLoans(partnerID, 'addProduct', {products: arr}, (result) => { if (result.status) { DCLoans(partnerID, 'saveOrder', { order: id, phone: phone, codeTT: codeTT, firstName: formProps['form_fields[name]'], lastName: formProps['form_fields[familiya]'], secondName: formProps['form_fields[ot4estvo]'], email: formProps['form_fields[mail]'] }, (result) => { console.log(result); }, debug); } }, debug); } }, debug); }) }) function DCCheckStatus(result) { let credit_result = '' switch (result) { case 0: credit_result = '2050' break case 1: credit_result = '2052' break case 3: credit_result = '2054' break case 4: credit_result = '2056' break case 5: credit_result = '2058' } /** Запрос на отправку данных на почту */ jQuery(function ($) { $.ajax({ url: '/wp-admin/admin-ajax.php', method: 'POST', data: { action: 'custom_form_send', order: id, phone: phone_raw, codeTT: codeTT, firstName: formProps['form_fields[name]'], lastName: formProps['form_fields[familiya]'], secondName: formProps['form_fields[ot4estvo]'], email: formProps['form_fields[mail]'], name: name_product, birthdate: formProps['form_fields[date_rojdenija]'], address: formProps['form_fields[City]'], price: price, credit_result: credit_result, metrikaclientid: yaCounter23555653.getClientID(), url: formProps['form_fields[url_my]'] } }).success(function (response) { if (response.success) { document.location.href = 'https://steelracing.ru/stranitsa-blagodarnosti-2020/' } else { console.log('error'); } }); }) } </script> </html>");
})



